<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비주얼 타이머</title>
    <style>
        /* 기존 스타일... */
        #timer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        #timerCanvas {
            margin-top: 20px;
            border: 1px solid #fff;
            border-radius: 50%;
        }
        .timerButton{
            font-size: 1.6rem;
        }
    </style>
</head>
<body>

    <div id="timer">
        <h1>인터벌 타이머</h1>
        <div id="timerButtons" style="display: flex; flex-wrap: wrap; justify-content: center;">
            <button class="timerButton" value="300">5분</button>
            <button class="timerButton" value="600">10분</button>
            <button class="timerButton" value="900">15분</button>
            <button class="timerButton" value="1200">20분</button>
            <button class="timerButton" value="1800">30분</button>
            <button class="timerButton" value="2400">40분</button>
            <button class="timerButton" value="3000">50분</button>
            <button class="timerButton" value="3600">60분</button>
            <button class="timerButton" value="5400">90분</button>
            <button class="timerButton" value="7200">120분</button>
            <button class="timerButton" value="9000">150분</button>
            <button class="timerButton" value="10800">180분</button>
        </div>
        
    </div>
    <center>
    <canvas id="timerCanvas" width="300" height="300" style="width: 60vw; height: 60vw; aspect-ratio: 1;"></canvas>
    </center>
    

    <script>
        let timerInterval;
        let totalTime;
        let remainingTime;
        let wakeLock = null;

        const canvas = document.getElementById('timerCanvas');
        const ctx = canvas.getContext('2d');

        async function requestWakeLock() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Screen Wake Lock is active');
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release().then(() => {
                    wakeLock = null;
                    console.log('Screen Wake Lock has been released');
                });
            }
        }

        function startTimer(duration) {
            clearInterval(timerInterval);
            totalTime = duration;
            remainingTime = duration;

            // 화면 잠금 요청
            requestWakeLock();

            timerInterval = setInterval(() => {
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    releaseWakeLock(); // 타이머 종료 시 화면 잠금 해제
                    alert("타이머가 종료되었습니다!");
                    return;
                }
                remainingTime--;
                drawTimer();
            }, 1000);
        }

        document.querySelectorAll('.timerButton').forEach(button => {
            button.addEventListener('click', () => {
                const selectedTime = parseInt(button.value);
                startTimer(selectedTime);
            });
        });

        function drawTimer() {
            const percentage = remainingTime / totalTime;
            const startAngle = -0.5 * Math.PI; // 시작 각도
            const endAngle = startAngle + (percentage * 2 * Math.PI); // 끝 각도

            ctx.clearRect(0, 0, canvas.width, canvas.height); // 캔버스 초기화
            ctx.beginPath();
            const radius = Math.min(canvas.width, canvas.height) / 2 - 10; // 반지름 계산
            ctx.arc(canvas.width / 2, canvas.height / 2, radius, startAngle, endAngle, false);
            ctx.lineTo(canvas.width / 2, canvas.height / 2);
            ctx.fillStyle = 'lightseagreen';
            ctx.fill();
            ctx.closePath();

            // 원형 테두리
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, radius, 0, 2 * Math.PI); // 반지름을 동일하게 설정
            
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 5;
            ctx.stroke();
            ctx.closePath();

            // 남은 시간 표시
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            const timeText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // 남은 시간 텍스트 가운데 정렬
            ctx.fillStyle = 'black';
            ctx.font = 'bold 2rem Arial'; // 글꼴 및 크기 설정
            ctx.textAlign = 'center'; // 가로 가운데 정렬
            ctx.textBaseline = 'middle'; // 세로 가운데 정렬
            ctx.fillText(timeText, canvas.width / 2, canvas.height / 2); // 텍스트 그리기
        }
    </script>
</body>
</html>