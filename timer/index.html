<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비주얼 타이머</title>
    <style>
        /* 기존 스타일... */
        #timer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        #timerCanvas {
            margin-top: 20px;
            border: 1px solid #fff;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div id="timer">
        <label for="timeSelect">타이머 설정:</label>
        <select id="timeSelect">
            <option value="300">5분</option>
            <option value="600">10분</option>
            <option value="900">15분</option>
            <option value="1200">20분</option>
            <option value="1800">30분</option>
            <option value="2400">40분</option>
            <option value="3000">50분</option>
            <option value="3600">60분</option>
            <option value="5400">90분</option>
            <option value="7200">120분</option>
            <option value="9000">150분</option>
            <option value="10800">180분</option>
        </select>
        <button id="startTimerButton" class="slotButton">타이머 시작</button>
    </div>
    <canvas id="timerCanvas" width="200" height="200"></canvas>

    <script>
        let timerInterval;
        let totalTime;
        let remainingTime;
        let wakeLock = null;

        const canvas = document.getElementById('timerCanvas');
        const ctx = canvas.getContext('2d');

        async function requestWakeLock() {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                console.log('Screen Wake Lock is active');
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release().then(() => {
                    wakeLock = null;
                    console.log('Screen Wake Lock has been released');
                });
            }
        }

        function startTimer(duration) {
            clearInterval(timerInterval);
            totalTime = duration;
            remainingTime = duration;

            // 화면 잠금 요청
            requestWakeLock();

            timerInterval = setInterval(() => {
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    releaseWakeLock(); // 타이머 종료 시 화면 잠금 해제
                    alert("타이머가 종료되었습니다!");
                    return;
                }
                remainingTime--;
                drawTimer();
            }, 1000);
        }

        function drawTimer() {
            const percentage = remainingTime / totalTime;
            const startAngle = -0.5 * Math.PI; // 시작 각도
            const endAngle = startAngle + (percentage * 2 * Math.PI); // 끝 각도

            ctx.clearRect(0, 0, canvas.width, canvas.height); // 캔버스 초기화
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 80, startAngle, endAngle, false);
            ctx.lineTo(canvas.width / 2, canvas.height / 2);
            ctx.fillStyle = 'lightseagreen';
            ctx.fill();
            ctx.closePath();

            // 원형 테두리
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 80, 0, 2 * Math.PI);
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 5;
            ctx.stroke();
            ctx.closePath();
        }

        document.getElementById('startTimerButton').addEventListener('click', () => {
            const selectedTime = parseInt(document.getElementById('timeSelect').value);
            startTimer(selectedTime);
        });
    </script>
</body>
</html>